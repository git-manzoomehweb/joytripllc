<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<style type="text/css">
    .cms-data-member {
        display: none
    }
    <basis core="call"file="Client_Final_Css_en.inc"/>
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.basiscore.net/basisfly.com/css/reservation_ConfirmStyle.css" />
<script type="text/javascript">
  <basis core = "call" file = "Client_Reservation_js.inc" />
</script>
<script src="https://cdn.basiscore.net/basisfly.com/js/reservation_ConfirmJs.js" type="text/javascript"></script>
<basis core="dbsource" source="basiscore" name="about" mid="5" lid="2" usedforid="[##cms.cms.ownerid##]">
    <member core="view" name="txt" type="view" postsql="select Answer from [about.txt] where prpID = '8000'" />
</basis>
<basis core="group" name="FirstDelay">
    <basis core="external.fly.ws" source="cmsDbService5" procedurename="dbsource" name="db" > <member
        name="factor" method="multiproduct"
        query='{
        "name" : "db",
        "mid" : "20",
        "member" : [
        {
        "type" : "scalar",
        "name" : "q",
        "request" : "factorpreform",
            "lid": "2",
        "agencycounter" : "[##cms.form.agencycounter##]",
        "agencycountername" : "[##cms.form.agencycountername##]",
        "code" : "[##cms.form.c_code##]",
        "club_discount" : "[##cms.form.club_discount##]",
        "invoicedesc" : "[##cms.form.invoicedesc##]",
        "currency_request" : "[##cms.form.currency_request##]",
        "userid" : "[##cms.form.userid##]",
        "accounttype" : "[##cms.form.accounttype##]",
        "mid" : "[##cms.form.mid##]",
        "clear" : "[##cms.form.clear##]",
        "trackingNo" : "[##cms.cookie.trackingid##]",
        "ownerid" : "[##cms.cms.ownerid##]",
        "factorid" : "0",
        "targetunit" : "10",
        "factortype" : "12",
        "passengerinfo" : [##cms.json.header##]
        
        }
        ]
        }'/> </basis>
    <basis core="group" name="SecondDelay">
        <basis core="inlinesource" name="db">
            <member name="TypeFactorpreform" format="json" preview=""
                postsql="select value from [db.TypeFactorpreform] where field = 'type'">
                {"root":[##db.factor.result##]}</member>
            <member name="CodeFactorpreform" format="json" preview=""
                postsql="select value from [db.CodeFactorpreform] where field = 'code'">
                {"root":[##db.factor.result##]}</member>
            <member name="DescriptionFactorpreform" format="json" preview=""
                postsql="select value from [db.DescriptionFactorpreform] where field = 'description'">
                {"root":[##db.factor.result##]}</member>
            <member name="Factorid" format="json" preview=""
                postsql="select value from [db.Factorid] where field = 'factorid'">{"root":[##db.factor.result##]}
            </member>
            <member name="NewpriceFactorpreform" format="json" preview=""
                postsql="select value from [db.NewpriceFactorpreform] where field = 'new_price'">
                {"root":[##db.factor.result##]}</member>
            <member name="NewtimeFactorpreform" format="json" preview=""
                postsql="select value from [db.NewtimeFactorpreform] where field = 'newtime'">
                {"root":[##db.factor.result##]}</member>

        </basis>
        <basis core="external.fly.ws" source="cmsDbService2" name="db" procedurename="dbsource">
            <member method="cms" name="webservice_detail" query='{
                "name": "db",
                "mid": "20",
                "member": [
                    {
                        "name": "q",
                        "type": "list",
                        "request": "webservice_Detail",
                        "id": [##cms.form.bank_id|("")##],
                        "dmnid": [##cms.cms.domainid##],
                        "lid":"2"
                    }
                ]
            }' />
        </basis>
        <basis core="group" name="DetailDelay">
            <basis core="inlinesource" name="db">
                <member name="bankid" format="json" postsql="select value from [db.bankid] where field = 'bankid'">
                    {"root":[##db.webservice_detail.result##]} </member>
                <member name="unit" format="json" postsql="select value from [db.unit] where field = 'unit'">
                    {"root":[##db.webservice_detail.result##]} </member>
            </basis>
            <basis core="group" name="PriceDelay1">
                <basis core="external.fly.ws" source="cmsDbService2" name="db" procedurename="dbsource">
                    <member name="FinalPrice" method="invoice" query='{
                   "name": "db",
                   "mid": "20",
                   "member": [
                      {
                         "type": "list",
                         "name": "q",
                         "request": "finalprice",
                         "trackingNo": "[##db.Factorid.Value|(0)##]",
                         "unit": "[##db.unit.Value##]"
                      }
                   ]
                }
                ' />
                </basis>
                <basis core="group" name="PriceDelay2">
                    <basis core="inlinesource" name="db">
                        <member name="firstpay" format="json" preview=""
                            postsql="select value from [db.firstpay] where field = 'firstprice'">
                            {"root":[##db.FinalPrice.result##]}
                        </member>
                        <member name="total" format="json" preview=""
                            postsql="select value from [db.total] where field = 'totalprice'">
                            {"root":[##db.FinalPrice.result##]}
                        </member>
                        <member name="totalwithcommision" format="json" preview=""
                            postsql="select value from [db.totalwithcommision] where field = 'totalwithcommision'">
                            {"root":[##db.FinalPrice.result##]}
                        </member>
                    </basis>
                    <basis core="dbsource" source="hosting" name="site">
                        <member name="address" type="list" request="siteaddress" />
                    </basis>
                    <basis core="group" name="DelayFactorpreformS" if="'[##db.TypeFactorpreform.Value##]'='0'">
                        <basis core="group" name="type" if="[##cms.form.accounttype##] = 3">

                            <div id="bgLoadding-box"></div>
                            <div id="payment-Loadding">
                                <div class="loader2"></div>
                                <div id="text-loading">Connecting to the electronic payment gateway, please
                                    wait a moment ...
                                </div>
                            </div>
                            <basis core="dbsource" source="accounting" name="db" bankid="[##db.bankid.Value##]" unit="[##db.unit.Value##]"
                                factorid="[##db.Factorid.Value|(0)##]" price="[##db.firstpay.Value##]" eid="1">
                                <member name="paymentid" type="scalar" request="paymentid" preview="" />
                            </basis>
                            <basis core="group" if="'[##db.paymentid.Column1##]' = 'not ok'">
                                <div id="text-loading">It is not possible to connect to the electronic payment gateway.</div>
                                <basis core="group" name="Nobank" if="'[##cms.form.bank_id##]' = '-1'">
                                    <div class="company_own">
                                        <div class="message-box">
                                            <div class="title-success"><span> Your pre-contract was successfully
                                                registered </span></div>
                                            <div class="message-info"><span class="question">Invoice number
                                                    :</span><span class="answer">[##db.Factorid.Value|(0)##]</span>
                                            </div>
                                            <div class="message-info"><span class="question">Invoice price:
                                                </span><span
                                                    class="answer slice-price">[##db.totalwithcommision.Value##]</span>
                                            </div>
                                            <div class="message-info"><span class="question">Invoice payable price  
                                                    :</span><span
                                                    class="answer slice-price">[##db.firstpay.Value##]</span>
                                            </div>
                                            <div class="Section">
                                                <div class="redirecPanel"><a
                                                    href="[##site.address.domain##]/EN-Panel-InvoiceView.bc?id=[##db.Factorid.Value|(0)##]"
                                                    target="_blank"> Click </a>to view the pre-contract
                                                in your user panel</div>
                                                <basis core="group" name="redirectpage" if="'[##cms.form.share##]' = '1'"><div class="link_homepage"><a href="/flight_share.bc">Return to the main page of the site</a></div></basis>
                                                <basis core="group" name="redirecthomepagehome" if="'[##cms.form.share##]' <> '1'"><div class="link_homepage"><a href="/EN">Return to the main page of the site</a></div></basis>
                                            </div>
                                            <div class="clr"></div>
                                        </div>
                                    </div>
                                    <script type="text/javascript">
                                        $("#bgLoadding-box,#payment-Loadding,#text-loading").hide()
                                        $(".slice-price").each(function () {
                                            $(this).text($(this).text().replace(
                                                /(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
                                        })
                                    </script>
                                </basis>
                            </basis>
                            <basis core="group" if="'[##db.paymentid.Column1##]' <> 'not ok'">
                                <basis core="group" name="Delay_save_inputs"
                                    if="[##cms.form.bank_id##] not in (35,51,55,57,66)">
                                    <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource"
                                        name="db">
                                        <member name="save_inputs" method="cms" query='{
                                   "name": "db",
                                   "mid": "20",
                                   "member": [
                                       {
                                           "request": "save_inputs",
                                           "id": "[##db.paymentid.Column1##]",
                                           "trackingid": "[##cms.cookie.trackingid##]",
                                           "rkey": "[##cms.cookie.rkey##]",
                                           "factorid": "[##db.Factorid.Value|(0)##]",
                                           "agencyid": "[##cms.form.agencyid|(0)##]",
                                           "paytype": "[##cms.form.paytype##]",
                                           "totalfinal": "[##db.firstpay.Value##]",
                                           "supplier": "[##cms.form.supplier##]",
                                           "bank_id": "[##cms.form.bank_id##]",
                                           "bankid": "[##db.bankid.Value##]",
                                           "paymentid": "[##db.paymentid.Column1##]",
                                           "factortype": "2"
                                       }
                                   ]
                               }' preview="" />
                                    </basis>
                                    <basis core="group" name="Saman" if="[##cms.form.bank_id##] = 31">
                                        <basis core="inlinesource" name="db">
                                            <member name="merchantID" format="json"
                                                postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="saman" name="saman"
                                                source="cmsDbService" procedurename="sbserviceprocedure1" preview="">
                                                <member name="m1" method="RequestToken" sort="random">
                                                    <params>
                                                        <param name="MID" value="[##db.merchantID.Value##]" />
                                                        <param name="ResNum" value="[##db.paymentid.Column1##]" />
                                                        <param name="Amount" value="[##db.firstpay.Value##]" />
                                                        <param name="SegAmount1" value="0" />
                                                        <param name="SegAmount2" value="0" />
                                                        <param name="SegAmount3" value="0" />
                                                        <param name="SegAmount4" value="0" />
                                                        <param name="SegAmount5" value="0" />
                                                        <param name="SegAmount6" value="0" />
                                                        <param name="AdditionalData1" value="" />
                                                        <param name="AdditionalData2" value="" />
                                                        <param name="Wage" value="0" />
                                                        <param name="RedirectUrl" value="" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                <input type="hidden" value='[##saman.m1.result##]' id="json" />
                                                <input type="hidden" value="" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    var str = document.getElementById("json").value;
                                                    str = str.replace(/"/g, ' ');
                                                    if (str == 'Time Out') {
                                                        document.getElementById("action").value = 0;
                                                    } else {
                                                        document.getElementById("action").value = 1;
                                                    }
                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            token: $("#json").val(),
                                                            action: $("#action").val(),
                                                            callback: "[##site.address.domain##]/Client_CallBack_en.bc",
                                                            bank_id: 31
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Mellat" if="[##cms.form.bank_id##] = 32">
                                        <basis core="inlinesource" name="db">
                                            <member name="terminalid" format="json"
                                                postsql="select value from [db.terminalid] where field = 'terminalid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="username" format="json"
                                                postsql="select value from [db.username] where field = 'username'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="password" format="json"
                                                postsql="select value from [db.password] where field = 'password'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="mellat" name="mellat"
                                                source="cmsDbService" procedurename="sbserviceprocedure1" preview="">
                                                <member name="m1" method="bpPayRequest" sort="random" preview="">
                                                    <params>
                                                        <param name="TerminalId" value="[##db.terminalid.Value##]" />
                                                        <param name="userName" value="[##db.username.Value##]" />
                                                        <param name="userPassword" value="[##db.password.Value##]" />
                                                        <param name="orderId" value="[##db.paymentid.Column1##]" />
                                                        <param name="amount" value="[##db.firstpay.Value##]" />
                                                        <param name="localDate" value="[##cms.cms.date2##]" />
                                                        <param name="localTime" value="[##cms.cms.time2##]" />
                                                        <param name="additionalData" value="" />
                                                        <param name="callBackUrl"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                        <param name="payerId" value="0" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="InnerDelay">
                                                <input type="hidden" value='[##mellat.m1.result##]' id="json" />
                                                <input type="hidden" value="" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    var str = document.getElementById("json").value;
                                                    str = str.replace(/'"/g, ' ');
                                                    if (str == 'Time Out') {
                                                        document.getElementById("action").value = 0;
                                                    } else {
                                                        document.getElementById("action").value = 1;
                                                    }
                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            token: $("#json").val(),
                                                            action: $("#action").val(),
                                                            bank_id: 32
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Psargad" if="[##cms.form.bank_id##] = 33">
                                        <basis core="inlinesource" name="db">
                                            <member name="merchantID" format="json"
                                                postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="terminalID" format="json"
                                                postsql="select value from [db.terminalID] where field = 'terminalid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="pasargadBank" name="pasargad"
                                                source="cmsDbService" procedurename="sbserviceprocedure1"
                                                preview="true">
                                                <member name="m1" method="pasargadGateway"
                                                    merchantCode="[##db.merchantID.Value##]" sort="random">
                                                    <params>
                                                        <param name="merchantCode" value="[##db.merchantID.Value##]" />
                                                        <param name="terminalCode" value="[##db.terminalID.Value##]" />
                                                        <param name="invoiceNumber"
                                                            value="[##db.paymentid.Column1##]" />
                                                        <param name="invoiceDate"
                                                            value="[##cms.cms.date##] [##cms.cms.time##]" />
                                                        <param name="amount" value="[##db.firstpay.Value##]" />
                                                        <param name="redirectAddress"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                        <param name="action" value="1003" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                [##pasargad.m1.result##]
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Pay" if="[##cms.form.bank_id##] = 34">
                                        <basis core="inlinesource" name="db">
                                            <member name="api" format="json"
                                                postsql="select value from [db.api] where field = 'api'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="pay" name="pay" source="cmsDbService"
                                                procedurename="sbserviceprocedure1" preview="">
                                                <member name="m1" method="send" sort="random">
                                                    <params>
                                                        <param name="api" value="[##db.api.Value##]" />
                                                        <param name="amount" value="[##db.firstpay.Value##]" />
                                                        <param name="redirect"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc?iN=[##db.paymentid.Column1##]" />
                                                        <param name="factorNumber" value="[##db.paymentid.Column1##]" />
                                                        <param name="description" value="" />
                                                    </params>
                                                </member>
                                            </basis>

                                            <basis core="group" name="InnerDelay">
                                                <input type="hidden" value='[##pay.m1.result##]' id="json" />
                                                <input type="hidden" value="" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    var str = document.getElementById("json").value;
                                                    str = str.replace(/'"/g, ' ');
                                                    if (str == 'Time Out') {
                                                        document.getElementById("action").value = 0;
                                                    } else {
                                                        document.getElementById("action").value = 1;
                                                    }
                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            token: $("#json").val(),
                                                            action: $("#action").val(),
                                                            bank_id: 34
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Asanpardakht" if="[##cms.form.bank_id##] = 38">
                                        <basis core="inlinesource" name="db">
                                            <member name="merchantID" format="json"
                                                postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="username" format="json"
                                                postsql="select value from [db.username] where field = 'username'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="password" format="json"
                                                postsql="select value from [db.password] where field = 'password'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="easyPayment" name="asanPardakht"
                                                source="cmsDbService" procedurename="sbserviceprocedure1" preview="">
                                                <member name="m1" method="RequestOperation" sort="random" preview="">
                                                    <params>
                                                        <param name="SSLid" value="13" />
                                                        <param name="merchantConfigurationID"
                                                            value="[##db.merchantID.Value##]" />
                                                        <param name="serviceCode" value="1" />
                                                        <param name="userName" value="[##db.username.Value##]" />
                                                        <param name="password" value="[##db.password.Value##]" />
                                                        <param name="paymentID" value="[##db.paymentid.Column1##]" />
                                                        <param name="amount" value="[##db.firstpay.Value##]" />
                                                        <param name="extraInfo" value="extra Information" />
                                                        <param name="callback"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                        <param name="factorID" value="0" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                <input type="hidden" value='[##asanPardakht.m1.result##]' id="json" />
                                                <input type="hidden" value="" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    var str = document.getElementById("json").value;
                                                    str = str.replace(/"/g, ' ');
                                                    if (str == 'Time Out') {
                                                        document.getElementById("action").value = 0;
                                                    } else {
                                                        document.getElementById("action").value = 1;
                                                    }
                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            token: $("#json").val(),
                                                            action: $("#action").val(),
                                                            callback: "[##site.address.domain##]/Client_CallBack_en.bc",
                                                            bank_id: 38
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Sekhavat" if="[##cms.form.bank_id##] = 39">
                                        <basis core="inlinesource" name="db">
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <input type="hidden" value="1" id="action" />
                                            <div class="sectionInfo"></div>
                                            <script type="text/javascript">
                                                $.ajax({
                                                    url: "/Client_Get_Token_en.bc",
                                                    type: "post",
                                                    data: {
                                                        paymentid: "[##db.paymentid.Column1##]",
                                                        factorid: "[##db.Factorid.Value|(0)##]",
                                                        totalfinal: "[##db.firstpay.Value##]",
                                                        agencyid: "[##cms.form.agencyid|(0)##]",
                                                        paytype: "[##cms.form.paytype##]",
                                                        supplier: "[##cms.form.supplier##]",
                                                        action: $("#action").val(),
                                                        callback: "[##site.address.domain##]/Client_CallBack_en.bc",
                                                        bank_id: 39,
                                                        factortype: 2
                                                    },
                                                    success: function (result) {
                                                        $(".sectionInfo").empty().html(result)
                                                    }
                                                });
                                            </script>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Gardeshgari" if="[##cms.form.bank_id##] = 50">
                                        <basis core="inlinesource" name="db">
                                            <member name="token" format="json"
                                                postsql="select value from [db.token] where field = 'token'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="gardeshPay" name="gardeshPay"
                                                source="cmsDbService" procedurename="sbserviceprocedure1"
                                                preview="true">
                                                <member name="m1" method="getToken" sort="random" preview="true">
                                                    <params>
                                                        <param name="amount" value="[##db.firstpay.Value##]" />
                                                        <param name="invoiceNumber"
                                                            value="[##db.paymentid.Column1##]" />
                                                        <param name="callback"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                        <param name="token" value="[##db.token.Value##]" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                <script type="text/javascript">
                                                    var obj = new Object([##gardeshPay.m1.result##])
                                                    var obj_1 = obj["gardeshPay_m1"]["answer"]
                                                    var obj_2 = JSON.parse(obj_1)
                                                    var field_1 = obj_2["data"]["url"] + '/'
                                                    var field_2 = obj_2["data"]["token"]
                                                    var url_redirect = field_1.concat(field_2);
                                                    window.location = url_redirect
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Sepah" if="[##cms.form.bank_id##] = 54">
                                        <basis core="inlinesource" name="db">
                                            <member name="token" format="json"
                                                postsql="select value from [db.token] where field = 'token'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="newSepah" name="newsepah"
                                                source="cmsDbService" procedurename="sbserviceprocedure1"
                                                preview="true">
                                                <member name="m1" method="SalePaymentRequest" sort="random"
                                                    preview="true">
                                                    <params>
                                                        <param name="LoginAccount" value="[##db.token.Value##]" />
                                                        <param name="Amount" value="[##db.firstpay.Value##]" />
                                                        <param name="OrderId" value="[##db.paymentid.Column1##]" />
                                                        <param name="CallBackUrl"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                <script type="text/javascript">
                                                    var obj = new Object([##newsepah.m1.result##])
                                                    var obj_1 = obj["newsepah_m1"]["Token"]
                                                    var field_1 = 'https://pec.shaparak.ir/NewIPG/?Token='
                                                    var url_redirect = field_1.concat(obj_1);
                                                    window.location = url_redirect
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="ArcaPayment" if="[##cms.form.bank_id##] = 59">
                                        <basis core="inlinesource" name="db">
                                            <member name="username" format="json"
                                                postsql="select value from [db.username] where field = 'username'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="password" format="json"
                                                postsql="select value from [db.password] where field = 'password'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="currency" format="json"
                                                postsql="select value from [db.currency] where field = 'currency'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="ArcaPayment" name="ArcaPayment"
                                                source="cmsDbService" procedurename="sbserviceprocedure1">
                                                <member name="m1" method="register" sort="random" preview="true">
                                                    <params>
                                                        <param name="orderNumber" value="[##db.paymentid.Column1##]" />
                                                        <param name="amount" value="[##db.firstpay.Value##]" />
                                                        <param name="currency" value="[##db.currency.Value##]" />
                                                        <param name="userName" value="[##db.username.Value##]" />
                                                        <param name="password" value="[##db.password.Value##]" />
                                                        <param name="returnUrl"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc?iN=[##db.paymentid.Column1##]" />
                                                        <param name="factorId" value="[##db.Factorid.Value|(0)##]" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                <script type="text/javascript">
                                                    var obj = new Object([##ArcaPayment.m1.result##])
                                                    var obj_1 = obj["ArcaPayment_m1"]["answer"];;
                                                    var obj_2 = JSON.parse(obj_1);
                                                    if (obj_2.errorCode == 0) {
                                                        var url_redirect = obj_2["formUrl"];
                                                        window.location = url_redirect
                                                    } else {
                                                        $("#payment-Loadding,#bgLoadding-box").show();
                                                        $("#text-loading").text(obj_2.errorMessage);
                                                    }
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="refah" if="[##cms.form.bank_id##] = 65">
                                        <basis core="inlinesource" name="db">
                                            <member name="terminalid" format="json"
                                                postsql="select value from [db.terminalid] where field = 'terminalid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="refah" name="refah"
                                                source="cmsDbService" procedurename="sbserviceprocedure1">
                                                <member name="m1" method="createToken" sort="random" preview="true">
                                                    <params>
                                                        <param name="Action" value="Token" />
                                                        <param name="Amount" value="[##db.firstpay.Value##]" />
                                                        <param name="callBackUrl"
                                                            value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                        <param name="ResNum" value="[##db.paymentid.Column1##]" />
                                                        <param name="CellNumber" value="" />
                                                        <param name="TerminalId" value="[##db.terminalid.Value##]" />
                                                    </params>
                                                </member>
                                            </basis>
                                            <basis core="group" name="delay4">
                                                <input type="hidden" value='[##refah.m1.result##]' id="json" />
                                                <input type="hidden" value="" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    var str = document.getElementById("json").value;
                                                    str = str.replace(/"/g, ' ');
                                                    if (str == 'Time Out') {
                                                        document.getElementById("action").value = 0;
                                                    } else {
                                                        document.getElementById("action").value = 1;
                                                    }
                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            token: $("#json").val(),
                                                            action: $("#action").val(),
                                                            bank_id: 65
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="clover" if="[##cms.form.bank_id##] = 71">
                                        <script type="text/javascript">
                                            $("#payment-Loadding,#bgLoadding-box,.waiting_text").hide();
                                            function separate_number(event, element) {
                                                event.target.value = event.target.value.replace(/\s/g, '').replace(/(\d{4})/g, '$1 ').trim();
                                                document.querySelector("input[name=cardnumber]").value = event.target.value.replace(/\s/g, '')
                                            };
                                            function focus_input(event, element, type) {
                                                if (event.target.value.length == 2) {
                                                    if (type == 'month') {
                                                        document.querySelector("input[name=expyear]").focus();
                                                    } else if (type == 'year') {
                                                        document.querySelector("input[name=cvv]").focus();
                                                    }
                                                }
                                            }
                                        </script>
                                        <section class="form-container">
                                            <div class="form-content">
                                                <form
                                                    action="/[##cms.form.callback|(Client_CallBack_en.bc)##]?iN=[##db.paymentid.Column1##]"
                                                    method="post">
                                                    <div class="infos-content">
                                                        <div class="info-content">
                                                            <div class="content">
                                                                <p class="title">Card Information</p>
                                                                <div class="item">
                                                                    <label>Card Type</label>
                                                                    <select name="cardtype" class="cardtype">
                                                                        <option value="visa">visa</option>
                                                                        <option value="master">master</option>
                                                                        <option value="payPal">payPal</option>
                                                                    </select>
                                                                </div>
                                                                <div class="item"><label>Card Holder Name</label>
                                                                    <input type="text" autocomplete="off"
                                                                        onkeyup="this.value=this.value.replace(/[^a-zA-Z _.]/g, '')" />
                                                                </div>
                                                                <div class="item"><label>Card Number *</label>
                                                                    <input  type="text" required 
                                                                        autocomplete="off"
                                                                        onkeyup="separate_number(event,this),this.value=this.value.replace(/[^0-9._ ]/g, '')" />
                                                                    <input type="hidden" name="cardnumber"/>
                                                                </div>
                                                                <div class="item exp-cvv">
                                                                    <div class="exp-content">
                                                                        <label>Exp Month / Year *</label>
                                                                        <input name="expmonth" type="text" required
                                                                            autocomplete="off" maxlength="2"
                                                                            onkeyup="focus_input(event,this,'month'),this.value=this.value.replace(/[^0-9.]/g, '')" />
                                                                        <input name="expyear" type="text" required
                                                                            autocomplete="off" maxlength="2" 
                                                                            onkeyup="focus_input(event,this,'year'),this.value=this.value.replace(/[^0-9.]/g, '')" />
                                                                    </div>
                                                                    <div class="cvv-content">
                                                                        <label>CVV *</label>
                                                                        <input name="cvv" type="text" required 
                                                                            autocomplete="off"
                                                                            onkeyup="this.value=this.value.replace(/[^0-9.]/g, '')" />
                                                                    </div>
                                                                    <div class="zip-content">
                                                                        <label>Zip / Postal Code</label>
                                                                        <input type="text" autocomplete="off"
                                                                             />
                                                                    </div>
                                                                    <div class="clr"></div>
                                                                </div>
                                                                <button type="submit">Continue To Checkout</button>
                                                            </div>
                                                        </div>

                                                        <div class="clr"></div>
                                                    </div>
                                                    <div class="clr"></div>
                                                </form>
                                            </div>
                                        </section>
                                    </basis>
                                    <basis core="group" name="Rayancard" if="[##cms.form.bank_id##] = 73">
                                        <basis core="inlinesource" name="db">
                                            <member name="acceptcode" format="json"
                                            postsql="select value from [db.acceptcode] where field = 'acceptcode'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="password" format="json"
                                                postsql="select value from [db.password] where field = 'password'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="bankid" format="json" postsql="select value from [db.bankid] where field = 'bankid'">
                                                  {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="group" name="bankgroup">
                                            <basis core="external.ws.ws" service="rayanCardPayment" name="rayancard" source="cmsDbService" procedurename="sbserviceprocedure1" preview="true">
                                                <member name="m1" method="token" sort="random">
                                                   <params>
                                                      <param name="acceptcode" value="[##db.acceptcode.Value##]"/>
                                                      <param name="password" value="[##db.password.Value##]"/>
                                                      <param name="orderid" value="[##db.paymentid.Column1##]"/>
                                                      <param name="redirect_url" value="[##site.address.domain##]/Client_CallBack_en.bc"/>
                                                      <param name="amount" value="[##db.firstpay.Value##]"/>
                                                   </params>
                                                </member>
                                             </basis>
                                            <basis core="group" name="delay4">
                                                <input type="hidden" value='[##rayancard.m1.result##]' id="json" />
                                                <input type="hidden" value="" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    var str = document.getElementById("json").value;
                                                    str = str.replace(/"/g, ' ');
                                                    if (str == 'Time Out') {
                                                        document.getElementById("action").value = 0;
                                                    } else {
                                                        document.getElementById("action").value = 1;
                                                    }
                                                    var obj = new Object([##rayancard.m1.result##]);
                                                    var obj_1 = obj["rayancard_m1"]["url"]

                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            payment_url: obj_1,
                                                            token: $("#json").val(),
                                                            action: $("#action").val(),
                                                            bank_id: 73
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                    </basis>
                                </basis>
                                <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 35">
                                    <basis core="inlinesource" name="db">
                                        <member name="merchantID" format="json"
                                            postsql="select value from [db.merchantID] where field = 'merchantid'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="callback" format="json"
                                            postsql="select value from [db.callback] where field = 'callback'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                    </basis>
                                    <basis core="external.ws.ws" service="zarrinPal" name="zarrinPal"
                                        source="cmsDbService" procedurename="sbserviceprocedure1" preview="true">
                                        <member name="m1" method="PaymentRequest" sort="random" preview="true">
                                            <params>
                                                <param name="MerchantID" value="[##db.merchantID.value##]" />
                                                <param name="Amount" value="[##db.firstpay.Value##]" />
                                                <param name="Description" value="get token for payment" />
                                                <param name="Email" value="" />
                                                <param name="Mobile" value="" />
                                                <param name="CallbackURL"
                                                    value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                            </params>
                                        </member>
                                    </basis>
                                    <basis core="group" name="InnerDelay">
                                        <input type="hidden" value='[##zarrinPal.m1.result##]' id="json" />
                                        <input type="hidden" value="" id="action" />
                                        <div class="sectionInfo"></div>
                                        <script type="text/javascript">
                                            var str = document.getElementById("json").value;
                                            var split_str = str.split('/')
                                            str = str.replace(/'"/g, ' ');
                                            if (str == 'Time Out') {
                                                document.getElementById("action").value = 0;
                                            } else {
                                                document.getElementById("action").value = 1;
                                            }
                                            $.ajax({
                                                url: "/Client_Get_Token_en.bc",
                                                type: "post",
                                                data: {
                                                    token: $("#json").val(),
                                                    action: $("#action").val(),
                                                    bank_id: 35,
                                                    Authority: split_str[5].replace(/[^\x00-\x7F]/g,
                                                        ""),
                                                    paymentid: "[##db.paymentid.Column1##]",
                                                    bankid: "[##db.bankid.Value##]",
                                                    supplier: "[##cms.form.supplier##]",
                                                    totalfinal: "[##db.firstpay.Value##]",
                                                    paytype: "[##cms.form.paytype##]",
                                                    agencyid: "[##cms.form.agencyid|(0)##]",
                                                    factorid: "[##db.Factorid.Value|(0)##]",
                                                    factortype: 2
                                                },
                                                success: function (result) {
                                                    $(".sectionInfo").empty().html(result)
                                                }
                                            });
                                        </script>
                                    </basis>
                                </basis>
                                <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 51">
                                    <basis core="inlinesource" name="db">
                                        <member name="token" format="json"
                                            postsql="select value from [db.token] where field = 'token'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="callback" format="json"
                                            postsql="select value from [db.callback] where field = 'callback'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                    </basis>
                                    <basis core="external.ws.ws" service="kipaaPayment" name="kipaa"
                                        source="cmsDbService" procedurename="sbserviceprocedure1" preview="true">
                                        <member name="m1" method="request_payment_token" sort="random" preview="true">
                                            <params>
                                                <param name="amount" value="[##db.firstpay.Value##]" />
                                                <param name="callback"
                                                    value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                <param name="token" value="[##db.token.Value##]" />
                                            </params>
                                        </member>
                                    </basis>
                                    <basis core="group" name="InnerDelay">
                                        <div class="sectionInfo"></div>
                                        <input type="hidden" value="" id="action" />
                                        <script type="text/javascript">
                                            var obj = new Object([##kipaa.m1.result##])
                                            var obj_1 = obj["kipaa_m1"]["answer"]
                                            var obj_2 = JSON.parse(obj_1)
                                            if (obj_2["Status"] == '200') {
                                                document.getElementById("action").value = 1;
                                            } else {
                                                document.getElementById("action").value = 0;
                                            }
                                            $.ajax({
                                                url: "/Client_Get_Token_en.bc",
                                                type: "post",
                                                data: {
                                                    token: obj_2["Content"]["payment_token"],
                                                    payment_url: "https://" + obj_2["Content"][
                                                        "payment_url"
                                                    ],
                                                    action: $("#action").val(),
                                                    bank_id: 51,
                                                    paymentid: "[##db.paymentid.Column1##]",
                                                    bankid: "[##db.bankid.Value##]",
                                                    supplier: "[##cms.form.supplier##]",
                                                    totalfinal: "[##db.firstpay.Value##]",
                                                    paytype: "[##cms.form.paytype##]",
                                                    agencyid: "[##cms.form.agencyid|(0)##]",
                                                    factorid: "[##db.Factorid.Value|(0)##]",
                                                    factortype: 2
                                                },
                                                success: function (result) {
                                                    $(".sectionInfo").empty().html(result)
                                                }
                                            });
                                        </script>
                                    </basis>
                                </basis>
                                <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 55">
                                    <basis core="inlinesource" name="db">
                                        <member name="token" format="json"
                                            postsql="select value from [db.token] where field = 'token'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="callback" format="json"
                                            postsql="select value from [db.callback] where field = 'callback'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                    </basis>
                                    <basis core="external.ws.ws" service="aghayePardakht" name="aghayePardakht"
                                        source="cmsDbService" procedurename="sbserviceprocedure1">
                                        <member name="m1" method="createToken" sort="random" preview="true">
                                            <params>
                                                <param name="pin" value="[##db.token.Value##]" />
                                                <param name="amount" value="[##db.firstpay.Value##]" />
                                                <param name="callback"
                                                    value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                <param name="invoice_id" value="[##db.Factorid.Value|(0)##]" />
                                            </params>
                                        </member>
                                    </basis>

                                    <basis core="group" name="InnerDelay">
                                        <div class="sectionInfo"></div>
                                        <input type="hidden" value="1" id="action" />
                                        <script type="text/javascript">
                                            var obj = new Object([##aghayePardakht.m1.result##])
                                            var obj_1 = obj["aghayePardakht_m1"]["url"]
                                            var split_obj_1 = obj_1.split('/')
                                            $.ajax({
                                                url: "/Client_Get_Token_en.bc",
                                                type: "post",
                                                data: {
                                                    token: split_obj_1[4],
                                                    payment_url: obj_1,
                                                    action: $("#action").val(),
                                                    bank_id: 55,
                                                    paymentid: "[##db.paymentid.Column1##]",
                                                    bankid: "[##db.bankid.Value##]",
                                                    supplier: "[##cms.form.supplier##]",
                                                    totalfinal: "[##db.firstpay.Value##]",
                                                    paytype: "[##cms.form.paytype##]",
                                                    agencyid: "[##cms.form.agencyid|(0)##]",
                                                    factorid: "[##db.Factorid.Value|(0)##]",
                                                    factortype: 2
                                                },
                                                success: function (result) {
                                                    $(".sectionInfo").empty().html(result)
                                                }
                                            });
                                        </script>
                                    </basis>
                                </basis>
                                <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 57">
                                    <basis core="inlinesource" name="db">
                                        <member name="username" format="json"
                                            postsql="select value from [db.username] where field = 'username'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="password" format="json"
                                            postsql="select value from [db.password] where field = 'password'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="serviceId" format="json"
                                            postsql="select value from [db.serviceId] where field = 'serviceId'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="callback" format="json"
                                            postsql="select value from [db.callback] where field = 'callback'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                    </basis>
                                    <basis core="external.ws.ws" service="ayandeh" name="ayandeh" source="cmsDbService"
                                        procedurename="sbserviceprocedure1">
                                        <member name="m1" method="createToken" sort="random" preview="true">
                                            <params>
                                                <param name="username" value="[##db.username.value##]" />
                                                <param name="password" value="[##db.password.value##]" />
                                                <param name="callBackUrl"
                                                    value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                <param name="serviceId" value="[##db.serviceId.value##]" />
                                                <param name="amount" value="[##db.firstpay.Value##]" />
                                                <param name="mobile" value="" />
                                            </params>
                                        </member>
                                    </basis>
                                    <basis core="group" name="InnerDelay">
                                        <input type="hidden" value='[##ayandeh.m1.result##]' id="json" />
                                        <input type="hidden" value="1" id="action" />
                                        <div class="sectionInfo"></div>
                                        <script type="text/javascript">
                                            $.ajax({
                                                url: "/Client_Get_Token_en.bc",
                                                type: "post",
                                                data: {
                                                    token: $("#json").val(),
                                                    action: $("#action").val(),
                                                    bank_id: 57,
                                                    paymentid: "[##db.paymentid.Column1##]",
                                                    bankid: "[##db.bankid.Value##]",
                                                    supplier: "[##cms.form.supplier##]",
                                                    totalfinal: "[##db.firstpay.Value##]",
                                                    paytype: "[##cms.form.paytype##]",
                                                    agencyid: "[##cms.form.agencyid|(0)##]",
                                                    factorid: "[##db.Factorid.Value|(0)##]",
                                                    factortype: 2
                                                },
                                                success: function (result) {
                                                    $(".sectionInfo").empty().html(result)
                                                }
                                            });
                                        </script>
                                    </basis>
                                </basis>
                                <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 66">
                                    <basis core="inlinesource" name="db">
                                        <member name="usr" format="json" postsql="select value from [db.usr] where field = 'usr'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="pwd" format="json" postsql="select value from [db.pwd] where field = 'pwd'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="merchantConfigurationId" format="json"
                                            postsql="select value from [db.merchantConfigurationId] where field = 'merchantConfigurationId'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                        <member name="callback" format="json" postsql="select value from [db.callback] where field = 'callback'">
                                            {"root":[##db.webservice_detail.result##]} </member>
                                    </basis>
                                    <basis core="external.ws.ws" service="shahrBank" name="shahr" source="cmsDbService"
                                        procedurename="sbserviceprocedure1">
                                        <member name="m1" method="token" sort="random" preview="true">
                                            <params>
                                                <param name="usr" value="[##db.usr.value##]" />
                                                <param name="pwd" value="[##db.pwd.value##]" />
                                                <param name="merchantConfigurationId" value="[##db.merchantConfigurationId.value##]" />
                                                <param name="localInvoiceId" value="[##db.Factorid.Value|(0)##]" />
                                                <param name="amount" value="[##db.firstpay.Value##]" />
                                                <param name="callbackurl" value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                            </params>
                                        </member>
                                    </basis>
                                    <basis core="group" name="InnerDelay">
                                        <input type="hidden" value="1" id="action" />
                                        <div class="sectionInfo"></div>
                                        <script type="text/javascript">
                                            var obj = new Object([##shahr.m1.result##]);
                                            var obj_1 = obj["shahr_m1"]["url"]
                                            var obj_2 = obj["shahr_m1"]["token"]
                                            $.ajax({
                                                url: "/Client_Get_Token_en.bc",
                                                type: "post",
                                                data: {
                                                    token: obj_2,
                                                    payment_url: obj_1,
                                                    action: $("#action").val(),
                                                    bank_id: 66,
                                                    paymentid: "[##db.paymentid.Column1##]",
                                                    bankid: "[##db.bankid.Value##]",
                                                    supplier: "[##cms.form.supplier##]",
                                                    totalfinal: "[##db.firstpay.Value##]",
                                                    paytype: "[##cms.form.paytype##]",
                                                    agencyid: "[##cms.form.agencyid|(0)##]",
                                                    factorid: "[##db.Factorid.Value|(0)##]",
                                                    factortype: 2
                                                },
                                                success: function (result) {
                                                    $(".sectionInfo").empty().html(result)
                                                }
                                            });
                                        </script>
                                    </basis>
                                </basis>
                            </basis>


                        </basis>
                        <basis core="group" name="type" if="[##cms.form.accounttype##] = 1">
                            <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource" name="db">
                                <member method="cms" name="accountjson" query='{
                                "name":"db",
                                "mid":"20",
                                "member":[{
                                "type":"scalar",
                                "name":"q",
                                "request":"accountjson",
                                "ownerid":"[##cms.cms.ownerid##]",
                                "dmnid":"[##cms.cms.domainid##]",
                                "factorid":"[##db.Factorid.Value|(0)##]",
                                "agencyid":"[##cms.form.agencyid|(0)##]",
                                "supplier":"[##cms.form.supplier##]",
                                "trackingNo":"[##cms.cookie.trackingid##]",
                         }]}' preview="" />
                            </basis>
                            <basis core="group" name="InnerDelay">
                                <basis core="dbsource" source="accounting" name="db" jsondata="_jsondata"
                                    trackingNo="[##cms.cookie.trackingid##]" ownerid="[##cms.cms.ownerid##]"
                                    factorid="[##db.Factorid.Value|(0)##]" userid="[##cms.form.userid##]"
                                    title="[##cms.form._root.account.fullname.firstname##] [##cms.form._root.account.fullname.lastname##]"
                                    email="[##cms.form._root.account.email##]"
                                    gender="[##cms.form._root.account.gender##]"
                                    cellphone="[##cms.form._root.account.tel##]"
                                    mobile="[##cms.form._root.account.mobile##]"
                                    address="[##cms.form._root.account.address##]"
                                    birthdate="[##cms.form._root.account.birthdate##]"
                                    postcode="[##cms.form._root.account.codepost##]"
                                    fax="[##cms.form._root.account.fax##]">
                                    <member name="accreservation" type="scalar" request="accreservation" />
                                    <params>
                                        <add name="jsondata" value='[##db.accountjson.result##]' />
                                    </params>
                                </basis>
                                <div id="bgLoadding-box"></div>
                                <basis core="dbsource" source="trust_login" name="db" usedforid="602">
                                    <member name="Form" request="jsonform" type="scalar" />
                                </basis>
                                <basis core="group" name="InnerDelay">
                                    <basis core="inlinesource" name="db">
                                        <member name="jsonform" format="json" preview=""
                                            postsql="select  Id , ParentId , case when trim(Field) is null  then  (select field from [db.jsonform] where id = a.parentid ) else field end as field, value , type , path  from [db.jsonform] as a">
                                            {"root":[##db.Form.json##]}</member>
                                    </basis>
                                    <form action="" method="post" class="Confirm">
                                        <div class="title-success"><span> Your pre-contract was successfully
                                            registered </span></div>
                                        <input type="hidden" name="userid" value="[##cms.form.userid##]" />
                                        <input type="hidden" value="[##db.Factorid.Value|(0)##]" name="factorid" />
                                        <div>
                                            <basis core="tree" datamembername="db.jsonform" idcol="id"
                                                parentidcol="parentid" nullvalue="null">
                                                <face filter="Field in ('schemaID')">
                                                    <input type="hidden" value="@value" name="_root.schemaID"
                                                        readonly />
                                                </face>
                                                <face filter="Field in ('schemaName')">
                                                    <input type="hidden" value="@value" name="_root.schemaName"
                                                        readonly />
                                                </face>
                                                <face filter="type in ('object','array')">@Child</face>
                                            </basis>
                                        </div>
                                        <div class="Section_box">
                                            <basis core="tree" datamembername="db.jsonform" idcol="id"
                                                parentidcol="parentid" nullvalue="null">
                                                <face filter="Field in ('obj') and type in ('object')">
                                                    <div class="Section">@Child
                                                        <div class="clr"></div>
                                                    </div>
                                                </face>
                                                <face filter="Field in ('question') and value <> ''">
                                                    <div class="QuestionForm">@value</div>
                                                </face>
                                                <face filter="Field in ('answer')">
                                                    <div class="AnswerForm">@value<span class="mtype"></span></div>
                                                </face>
                                                <face filter="Field in ('prpid','typeid','value')">@value</face>
                                                <face filter="type in ('object','array')">@Child</face>
                                            </basis>
                                        </div>
                                        <div class="Section">
                                            <div class="redirecPanel"><a
                                                href="[##site.address.domain##]/EN-Panel-InvoiceView.bc?id=[##db.Factorid.Value|(0)##]"
                                                target="_blank"> Click </a>to view the pre-contract
                                            in your user panel</div>
                                            <div class="link_homepage"><a href="/EN">Return to the main page of the
                                                site</a></div>
                                            <div class="clr"></div>
                                        </div>
                                        </form>
                                        <div class="Hide_Box" style="display:none">
                                            <input type="hidden" value="[##db.total.Value##]" class="total">
                                                <input type="hidden" value="[##db.firstpay.Value##]" class="totalcom">
                                                    <input type="hidden"
                                                        value="/reservation/invoice/view.bc?cat=202&id=[##db.Factorid.Value|(0)##]&open=1"
                                                        class="link">
                                                        <input type="hidden" value="[##db.Factorid.Value|(0)##]"
                                                            class="invoiceid">
                                                            <input type="hidden" value="[##cms.form.moneytype##]"
                                                                class="moneytype">
                                        </div>
                                        <script type="text/javascript">
                                            $(".Section_box").find(".Section").each(function (i) {
                                                if (i == 0) {
                                                    $(this).find(".AnswerForm").find("input[type=text]").val($(
                                                        ".invoiceid").val())
                                                    $(this).find(".AnswerForm").find("input[type=text]").prop(
                                                        'readonly', true);
                                                }

                                                if (i == 1) {
                                                    $(this).find(".AnswerForm").find(".part").each(function (
                                                        j) {
                                                        if (j == 0) {
                                                            $(this).find("input[type=text]").val(
                                                                parseInt($(
                                                                    ".total").val())
                                                                .toLocaleString())
                                                            $(this).find("input[type=text]").addClass(
                                                                "Seprator")
                                                            $(this).find("input[type=text]").prop(
                                                                'readonly',
                                                                true);
                                                        }

                                                        if (j == 1) {
                                                            $(this).find("input[type=text]").val($(
                                                                    ".moneytype")
                                                                .val())
                                                            $(this).closest(".AnswerForm").find(
                                                                    ".mtype")
                                                                .text(
                                                                    $(".moneytype").val())
                                                            $(this).hide()
                                                        }
                                                    })
                                                }

                                                if (i == 2) {
                                                    $(this).find(".AnswerForm").find(".part").each(function (
                                                        j) {
                                                        if (j == 0) {
                                                            $(this).find("input[type=text]").val(
                                                                parseInt($(
                                                                    ".totalcom").val())
                                                                .toLocaleString())
                                                            $(this).find("input[type=text]").addClass(
                                                                "Seprator")
                                                            $(this).find("input[type=text]").prop(
                                                                'readonly', true);

                                                        }

                                                        if (j == 1) {
                                                            $(this).find("input[type=text]").val($(
                                                                    ".moneytype")
                                                                .val())
                                                            $(this).closest(".AnswerForm").find(
                                                                    ".mtype")
                                                                .text(
                                                                    $(".moneytype").val())
                                                            $(this).hide()
                                                        }
                                                    })
                                                }

                                                if (i == 3) {
                                                    $(this).find(".AnswerForm").find("input[type=text]").val($(
                                                            ".link")
                                                        .val())
                                                    $(this).hide()
                                                    $(this).css("margin", "0")
                                                }
                                            })

                                            $(".Confirm").submit(function (e) {
                                                $(".Seprator").each(function () {
                                                    var x = $(this).val();
                                                    var y = x.split(",");
                                                    var z = "";

                                                    for (var i = 0; i < y.length; i++) {
                                                        z += y[i]
                                                    };

                                                    $(this).val(z)
                                                })

                                            });
                                        </script>
                                </basis>
                            </basis>
                        </basis>
                        <basis core="group" name="type" if="[##cms.form.accounttype##] = 2">
                            <basis core="group" name="pay_type" if="'[##cms.form.paytype##]' = 'credit'">
                                <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource" name="db">
                                    <member name="save_inputs" method="cms" query='{
                                     "name": "db",
                                     "mid": "20",
                                     "member": [
                                         {
                                             "request": "save_inputs",
                                             "id": "[##db.Factorid.Value|(0)##]",
                                             "trackingid": "[##cms.cookie.trackingid##]",
                                             "rkey": "[##cms.cookie.rkey##]",
                                             "factorid": "[##db.Factorid.Value|(0)##]",
                                             "agencyid": "[##cms.form.agencyid|(0)##]",
                                             "paytype": "[##cms.form.paytype##]",
                                             "totalfinal": "[##db.firstpay.Value##]",
                                             "supplier": "[##cms.form.supplier##]",
                                             "factortype": "2"
                                            
                                         }
                                     ]
                                 }' preview="" />
                                </basis>
                                <form method="post" action="/Client_CallBack_en.bc" id="Credit_payment_form">
                                    <input type="hidden" value="1" name="Credit_payment" />
                                    <input type="hidden" value="[##db.Factorid.Value|(0)##]" name="ResNum" />
                                    </form>
                                    <div id="bgLoadding-box"></div>
                                    <div id="payment-Loadding">
                                        <div class="loader2"></div>
                                        <div id="text-loading">Issuing pre-contract, please
                                            wait a moment ...
                                        </div>
                                    </div>
                                    <script type="text/javascript">
                                        $("#Credit_payment_form").submit()
                                    </script>

                            </basis>
                            <basis core="group" name="pay_type" if="'[##cms.form.paytype##]' = 'bank'">
                                <div id="bgLoadding-box"></div>
                                <div id="payment-Loadding">
                                    <div class="loader2"></div>
                                    <div id="text-loading">Connecting to the electronic payment gateway, please
                                        wait a moment ...
                                    </div>
                                </div>
                                <basis core="dbsource" source="accounting" name="db" bankid="[##db.bankid.Value##]" unit="[##db.unit.Value##]"
                                    factorid="[##db.Factorid.Value|(0)##]" price="[##db.firstpay.Value##]" eid="1">
                                    <member name="paymentid" type="scalar" request="paymentid" preview="" />
                                </basis>
                                <basis core="group" if="'[##db.paymentid.Column1##]' = 'not ok'">
                                    <div id="text-loading">It is not possible to connect to the electronic
                                        payment gateway.</div>
                                    <basis core="group" name="Nobank" if="'[##cms.form.bank_id##]' = '-1'">
                                        <div class="company_own">
                                            <div class="message-box">
                                                <div class="title-success"><span> Your pre-contract was successfully
                                                    registered </span></div>
                                                <div class="message-info"><span class="question">Invoice number
                                                        :</span><span class="answer">[##db.Factorid.Value|(0)##]</span>
                                                </div>
                                                <div class="message-info"><span class="question">Invoice price:
                                                    </span><span
                                                        class="answer slice-price">[##db.totalwithcommision.Value##]</span>
                                                </div>
                                                <div class="message-info"><span class="question"> Invoice payable price
                                                         :</span><span
                                                        class="answer slice-price">[##db.firstpay.Value##]</span>
                                                </div>
                                                <div class="Section">
                                                    <div class="redirecPanel"><a
                                                        href="[##site.address.domain##]/EN-Panel-InvoiceView.bc?id=[##db.Factorid.Value|(0)##]"
                                                        target="_blank"> Click </a>to view the pre-contract
                                                    in your user panel</div>
                                                    <basis core="group" name="redirectpage" if="'[##cms.form.share##]' = '1'"><div class="link_homepage"><a href="/flight_share.bc">Return to the main page of the site</a></div></basis>
                                                    <basis core="group" name="redirecthomepagehome" if="'[##cms.form.share##]' <> '1'"><div class="link_homepage"><a href="/EN">Return to the main page of the site</a></div></basis>
                                                </div>
                                                <div class="clr"></div>
                                            </div>
                                        </div>
                                        <script type="text/javascript">
                                            $("#bgLoadding-box,#payment-Loadding,#text-loading").hide()
                                            $(".slice-price").each(function () {
                                                $(this).text($(this).text().replace(
                                                    /(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
                                            })
                                        </script>
                                    </basis>
                                </basis>
                                <basis core="group" if="'[##db.paymentid.Column1##]' <> 'not ok'">
                                    <basis core="group" name="Delay_save_inputs"
                                        if="[##cms.form.bank_id##] not in (35,51,55,57,66)">
                                        <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource"
                                            name="db">
                                            <member name="save_inputs" method="cms" query='{
                                            "name": "db",
                                            "mid": "20",
                                            "member": [
                                                {
                                                    "request": "save_inputs",
                                                    "id": "[##db.paymentid.Column1##]",
                                                    "trackingid": "[##cms.cookie.trackingid##]",
                                                    "rkey": "[##cms.cookie.rkey##]",
                                                    "factorid": "[##db.Factorid.Value|(0)##]",
                                                    "agencyid": "[##cms.form.agencyid|(0)##]",
                                                    "paytype": "[##cms.form.paytype##]",
                                                    "totalfinal": "[##db.firstpay.Value##]",
                                                    "supplier": "[##cms.form.supplier##]",
                                                    "bank_id": "[##cms.form.bank_id##]",
                                                    "bankid": "[##db.bankid.Value##]",
                                                    "paymentid": "[##db.paymentid.Column1##]",
                                                    "factortype": "2"
                                                }
                                            ]
                                        }' preview="" />
                                        </basis>
                                        <basis core="group" name="Saman" if="[##cms.form.bank_id##] = 31">
                                            <basis core="inlinesource" name="db">
                                                <member name="merchantID" format="json"
                                                    postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="saman" name="saman"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="">
                                                    <member name="m1" method="RequestToken" sort="random">
                                                        <params>
                                                            <param name="MID" value="[##db.merchantID.Value##]" />
                                                            <param name="ResNum" value="[##db.paymentid.Column1##]" />
                                                            <param name="Amount" value="[##db.firstpay.Value##]" />
                                                            <param name="SegAmount1" value="0" />
                                                            <param name="SegAmount2" value="0" />
                                                            <param name="SegAmount3" value="0" />
                                                            <param name="SegAmount4" value="0" />
                                                            <param name="SegAmount5" value="0" />
                                                            <param name="SegAmount6" value="0" />
                                                            <param name="AdditionalData1" value="" />
                                                            <param name="AdditionalData2" value="" />
                                                            <param name="Wage" value="0" />
                                                            <param name="RedirectUrl" value="" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    <input type="hidden" value='[##saman.m1.result##]' id="json" />
                                                    <input type="hidden" value="" id="action" />
                                                    <div class="sectionInfo"></div>
                                                    <script type="text/javascript">
                                                        var str = document.getElementById("json").value;
                                                        str = str.replace(/"/g, ' ');
                                                        if (str == 'Time Out') {
                                                            document.getElementById("action").value = 0;
                                                        } else {
                                                            document.getElementById("action").value = 1;
                                                        }
                                                        $.ajax({
                                                            url: "/Client_Get_Token_en.bc",
                                                            type: "post",
                                                            data: {
                                                                token: $("#json").val(),
                                                                action: $("#action").val(),
                                                                callback: "[##site.address.domain##]/Client_CallBack_en.bc",
                                                                bank_id: 31
                                                            },
                                                            success: function (result) {
                                                                $(".sectionInfo").empty().html(
                                                                    result)
                                                            }
                                                        });
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Mellat" if="[##cms.form.bank_id##] = 32">
                                            <basis core="inlinesource" name="db">
                                                <member name="terminalid" format="json"
                                                    postsql="select value from [db.terminalid] where field = 'terminalid'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="username" format="json"
                                                    postsql="select value from [db.username] where field = 'username'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="password" format="json"
                                                    postsql="select value from [db.password] where field = 'password'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="mellat" name="mellat"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="">
                                                    <member name="m1" method="bpPayRequest" sort="random" preview="">
                                                        <params>
                                                            <param name="TerminalId"
                                                                value="[##db.terminalid.Value##]" />
                                                            <param name="userName" value="[##db.username.Value##]" />
                                                            <param name="userPassword"
                                                                value="[##db.password.Value##]" />
                                                            <param name="orderId" value="[##db.paymentid.Column1##]" />
                                                            <param name="amount" value="[##db.firstpay.Value##]" />
                                                            <param name="localDate" value="[##cms.cms.date2##]" />
                                                            <param name="localTime" value="[##cms.cms.time2##]" />
                                                            <param name="additionalData" value="" />
                                                            <param name="callBackUrl"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                            <param name="payerId" value="0" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="InnerDelay">
                                                    <input type="hidden" value='[##mellat.m1.result##]' id="json" />
                                                    <input type="hidden" value="" id="action" />
                                                    <div class="sectionInfo"></div>
                                                    <script type="text/javascript">
                                                        var str = document.getElementById("json").value;
                                                        str = str.replace(/'"/g, ' ');
                                                        if (str == 'Time Out') {
                                                            document.getElementById("action").value = 0;
                                                        } else {
                                                            document.getElementById("action").value = 1;
                                                        }
                                                        $.ajax({
                                                            url: "/Client_Get_Token_en.bc",
                                                            type: "post",
                                                            data: {
                                                                token: $("#json").val(),
                                                                action: $("#action").val(),
                                                                bank_id: 32
                                                            },
                                                            success: function (result) {
                                                                $(".sectionInfo").empty().html(
                                                                    result)
                                                            }
                                                        });
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Psargad" if="[##cms.form.bank_id##] = 33">
                                            <basis core="inlinesource" name="db">
                                                <member name="merchantID" format="json"
                                                    postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="terminalID" format="json"
                                                    postsql="select value from [db.terminalID] where field = 'terminalid'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">

                                                <basis core="external.ws.ws" service="pasargadBank" name="pasargad"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="true">
                                                    <member name="m1" method="pasargadGateway"
                                                        merchantCode="[##db.merchantID.Value##]" sort="random">
                                                        <params>
                                                            <param name="merchantCode"
                                                                value="[##db.merchantID.Value##]" />
                                                            <param name="terminalCode"
                                                                value="[##db.terminalID.Value##]" />
                                                            <param name="invoiceNumber"
                                                                value="[##db.paymentid.Column1##]" />
                                                            <param name="invoiceDate"
                                                                value="[##cms.cms.date##] [##cms.cms.time##]" />
                                                            <param name="amount" value="[##db.firstpay.Value##]" />
                                                            <param name="redirectAddress"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                            <param name="action" value="1003" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    [##pasargad.m1.result##]
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Pay" if="[##cms.form.bank_id##] = 34">
                                            <basis core="inlinesource" name="db">
                                                <member name="api" format="json"
                                                    postsql="select value from [db.api] where field = 'api'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="pay" name="pay"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="">
                                                    <member name="m1" method="send" sort="random">
                                                        <params>
                                                            <param name="api" value="[##db.api.Value##]" />
                                                            <param name="amount" value="[##db.firstpay.Value##]" />
                                                            <param name="redirect"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                            <param name="factorNumber"
                                                                value="[##db.paymentid.Column1##]" />
                                                            <param name="description" value="" />
                                                        </params>
                                                    </member>
                                                </basis>

                                                <basis core="group" name="InnerDelay">
                                                    <input type="hidden" value='[##pay.m1.result##]' id="json" />
                                                    <input type="hidden" value="" id="action" />
                                                    <div class="sectionInfo"></div>
                                                    <script type="text/javascript">
                                                        var str = document.getElementById("json").value;
                                                        str = str.replace(/'"/g, ' ');
                                                        if (str == 'Time Out') {
                                                            document.getElementById("action").value = 0;
                                                        } else {
                                                            document.getElementById("action").value = 1;
                                                        }
                                                        $.ajax({
                                                            url: "/Client_Get_Token_en.bc",
                                                            type: "post",
                                                            data: {
                                                                token: $("#json").val(),
                                                                action: $("#action").val(),
                                                                bank_id: 34
                                                            },
                                                            success: function (result) {
                                                                $(".sectionInfo").empty().html(
                                                                    result)
                                                            }
                                                        });
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Asanpardakht" if="[##cms.form.bank_id##] = 38">
                                            <basis core="inlinesource" name="db">
                                                <member name="merchantID" format="json"
                                                    postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="username" format="json"
                                                    postsql="select value from [db.username] where field = 'username'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="password" format="json"
                                                    postsql="select value from [db.password] where field = 'password'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="easyPayment" name="asanPardakht"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="">
                                                    <member name="m1" method="RequestOperation" sort="random"
                                                        preview="">
                                                        <params>
                                                            <param name="SSLid" value="13" />
                                                            <param name="merchantConfigurationID"
                                                                value="[##db.merchantID.Value##]" />
                                                            <param name="serviceCode" value="1" />
                                                            <param name="userName" value="[##db.username.Value##]" />
                                                            <param name="password" value="[##db.password.Value##]" />
                                                            <param name="paymentID"
                                                                value="[##db.paymentid.Column1##]" />
                                                            <param name="amount" value="[##db.firstpay.Value##]" />
                                                            <param name="extraInfo" value="extra Information" />
                                                            <param name="callback"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                            <param name="factorID" value="0" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    <input type="hidden" value='[##asanPardakht.m1.result##]'
                                                        id="json" />
                                                    <input type="hidden" value="" id="action" />
                                                    <div class="sectionInfo"></div>
                                                    <script type="text/javascript">
                                                        var str = document.getElementById("json").value;
                                                        str = str.replace(/"/g, ' ');
                                                        if (str == 'Time Out') {
                                                            document.getElementById("action").value = 0;
                                                        } else {
                                                            document.getElementById("action").value = 1;
                                                        }
                                                        $.ajax({
                                                            url: "/Client_Get_Token_en.bc",
                                                            type: "post",
                                                            data: {
                                                                token: $("#json").val(),
                                                                action: $("#action").val(),
                                                                callback: "[##site.address.domain##]/Client_CallBack_en.bc",
                                                                bank_id: 38
                                                            },
                                                            success: function (result) {
                                                                $(".sectionInfo").empty().html(
                                                                    result)
                                                            }
                                                        });
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Sekhavat" if="[##cms.form.bank_id##] = 39">
                                            <basis core="inlinesource" name="db">
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <input type="hidden" value="1" id="action" />
                                                <div class="sectionInfo"></div>
                                                <script type="text/javascript">
                                                    $.ajax({
                                                        url: "/Client_Get_Token_en.bc",
                                                        type: "post",
                                                        data: {
                                                            paymentid: "[##db.paymentid.Column1##]",
                                                            factorid: "[##db.Factorid.Value|(0)##]",
                                                            totalfinal: "[##db.firstpay.Value##]",
                                                            agencyid: "[##cms.form.agencyid|(0)##]",
                                                            paytype: "[##cms.form.paytype##]",
                                                            supplier: "[##cms.form.supplier##]",
                                                            action: $("#action").val(),
                                                            callback: "[##site.address.domain##]/Client_CallBack_en.bc",
                                                            bank_id: 39,
                                                            factortype: 2
                                                        },
                                                        success: function (result) {
                                                            $(".sectionInfo").empty().html(result)
                                                        }
                                                    });
                                                </script>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Gardeshgari" if="[##cms.form.bank_id##] = 50">
                                            <basis core="inlinesource" name="db">
                                                <member name="token" format="json"
                                                    postsql="select value from [db.token] where field = 'token'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="gardeshPay" name="gardeshPay"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="true">
                                                    <member name="m1" method="getToken" sort="random" preview="true">
                                                        <params>
                                                            <param name="amount" value="[##db.firstpay.Value##]" />
                                                            <param name="invoiceNumber"
                                                                value="[##db.paymentid.Column1##]" />
                                                            <param name="callback"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                            <param name="token" value="[##db.token.Value##]" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    <script type="text/javascript">
                                                        var obj = new Object([##gardeshPay.m1.result##])
                                                        var obj_1 = obj["gardeshPay_m1"]["answer"]
                                                        var obj_2 = JSON.parse(obj_1)
                                                        var field_1 = obj_2["data"]["url"] + '/'
                                                        var field_2 = obj_2["data"]["token"]
                                                        var url_redirect = field_1.concat(field_2);
                                                        window.location = url_redirect
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="Sepah" if="[##cms.form.bank_id##] = 54">
                                            <basis core="inlinesource" name="db">
                                                <member name="token" format="json"
                                                    postsql="select value from [db.token] where field = 'token'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="newSepah" name="newsepah"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1"
                                                    preview="true">
                                                    <member name="m1" method="SalePaymentRequest" sort="random"
                                                        preview="true">
                                                        <params>
                                                            <param name="LoginAccount" value="[##db.token.Value##]" />
                                                            <param name="Amount" value="[##db.firstpay.Value##]" />
                                                            <param name="OrderId" value="[##db.paymentid.Column1##]" />
                                                            <param name="CallBackUrl"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    <script type="text/javascript">
                                                        var obj = new Object([##newsepah.m1.result##])
                                                        var obj_1 = obj["newsepah_m1"]["Token"]
                                                        var field_1 = 'https://pec.shaparak.ir/NewIPG/?Token='
                                                        var url_redirect = field_1.concat(obj_1);
                                                        window.location = url_redirect
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="ArcaPayment" if="[##cms.form.bank_id##] = 59">
                                            <basis core="inlinesource" name="db">
                                                <member name="username" format="json"
                                                    postsql="select value from [db.username] where field = 'username'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="password" format="json"
                                                    postsql="select value from [db.password] where field = 'password'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="currency" format="json"
                                                    postsql="select value from [db.currency] where field = 'currency'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="ArcaPayment" name="ArcaPayment"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1">
                                                    <member name="m1" method="register" sort="random" preview="true">
                                                        <params>
                                                            <param name="orderNumber"
                                                                value="[##db.paymentid.Column1##]" />
                                                            <param name="amount" value="[##db.firstpay.Value##]" />
                                                            <param name="currency" value="[##db.currency.Value##]" />
                                                            <param name="userName" value="[##db.username.Value##]" />
                                                            <param name="password" value="[##db.password.Value##]" />
                                                            <param name="returnUrl"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc?iN=[##db.paymentid.Column1##]" />
                                                            <param name="factorId"
                                                                value="[##db.Factorid.Value|(0)##]" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    <script type="text/javascript">
                                                        var obj = new Object([##ArcaPayment.m1.result##])
                                                        var obj_1 = obj["ArcaPayment_m1"]["answer"];;
                                                        var obj_2 = JSON.parse(obj_1);
                                                        if (obj_2.errorCode == 0) {
                                                            var url_redirect = obj_2["formUrl"];
                                                            window.location = url_redirect
                                                        } else {
                                                            $("#payment-Loadding,#bgLoadding-box").show();
                                                            $("#text-loading").text(obj_2.errorMessage);
                                                        }
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="refah" if="[##cms.form.bank_id##] = 65">
                                            <basis core="inlinesource" name="db">
                                                <member name="terminalid" format="json"
                                                    postsql="select value from [db.terminalid] where field = 'terminalid'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="refah" name="refah"
                                                    source="cmsDbService" procedurename="sbserviceprocedure1">
                                                    <member name="m1" method="createToken" sort="random" preview="true">
                                                        <params>
                                                            <param name="Action" value="Token" />
                                                            <param name="Amount" value="[##db.firstpay.Value##]" />
                                                            <param name="callBackUrl"
                                                                value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                            <param name="ResNum" value="[##db.paymentid.Column1##]" />
                                                            <param name="CellNumber" value="" />
                                                            <param name="TerminalId"
                                                                value="[##db.terminalid.Value##]" />
                                                        </params>
                                                    </member>
                                                </basis>
                                                <basis core="group" name="delay4">
                                                    <input type="hidden" value='[##refah.m1.result##]' id="json" />
                                                    <input type="hidden" value="" id="action" />
                                                    <div class="sectionInfo"></div>
                                                    <script type="text/javascript">
                                                        var str = document.getElementById("json").value;
                                                        str = str.replace(/"/g, ' ');
                                                        if (str == 'Time Out') {
                                                            document.getElementById("action").value = 0;
                                                        } else {
                                                            document.getElementById("action").value = 1;
                                                        }
                                                        $.ajax({
                                                            url: "/Client_Get_Token_en.bc",
                                                            type: "post",
                                                            data: {
                                                                token: $("#json").val(),
                                                                action: $("#action").val(),
                                                                bank_id: 65
                                                            },
                                                            success: function (result) {
                                                                $(".sectionInfo").empty().html(
                                                                    result)
                                                            }
                                                        });
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                        <basis core="group" name="clover" if="[##cms.form.bank_id##] = 71">
                                            <script type="text/javascript">
                                                $("#payment-Loadding,#bgLoadding-box,.waiting_text").hide();
                                                function separate_number(event, element) {
                                                    event.target.value = event.target.value.replace(/\s/g, '').replace(/(\d{4})/g, '$1 ').trim();
                                                    document.querySelector("input[name=cardnumber]").value = event.target.value.replace(/\s/g, '')
                                                };
                                                function focus_input(event, element, type) {
                                                    if (event.target.value.length == 2) {
                                                        if (type == 'month') {
                                                            document.querySelector("input[name=expyear]").focus();
                                                        } else if (type == 'year') {
                                                            document.querySelector("input[name=cvv]").focus();
                                                        }
                                                    }
                                                }
                                            </script>
                                            <section class="form-container">
                                                <div class="form-content">
                                                    <form
                                                        action="/[##cms.form.callback|(Client_CallBack_en.bc)##]?iN=[##db.paymentid.Column1##]"
                                                        method="post">
                                                        <div class="infos-content">
                                                            <div class="info-content">
                                                                <div class="content">
                                                                    <p class="title">Card Information</p>
                                                                    <div class="item">
                                                                        <label>Card Type</label>
                                                                        <select name="cardtype" class="cardtype">
                                                                            <option value="visa">visa</option>
                                                                            <option value="master">master</option>
                                                                            <option value="payPal">payPal</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="item"><label>Card Holder Name</label>
                                                                        <input type="text" autocomplete="off"
                                                                            onkeyup="this.value=this.value.replace(/[^a-zA-Z _.]/g, '')" />
                                                                    </div>
                                                                    <div class="item"><label>Card Number *</label>
                                                                        <input  type="text" required 
                                                                            autocomplete="off"
                                                                            onkeyup="separate_number(event,this),this.value=this.value.replace(/[^0-9._ ]/g, '')" />
                                                                        <input type="hidden" name="cardnumber"/>
                                                                    </div>
                                                                    <div class="item exp-cvv">
                                                                        <div class="exp-content">
                                                                            <label>Exp Month / Year *</label>
                                                                            <input name="expmonth" type="text" required
                                                                                autocomplete="off" maxlength="2"
                                                                                onkeyup="focus_input(event,this,'month'),this.value=this.value.replace(/[^0-9.]/g, '')" />
                                                                            <input name="expyear" type="text" required
                                                                                autocomplete="off" maxlength="2" 
                                                                                onkeyup="focus_input(event,this,'year'),this.value=this.value.replace(/[^0-9.]/g, '')" />
                                                                        </div>
                                                                        <div class="cvv-content">
                                                                            <label>CVV *</label>
                                                                            <input name="cvv" type="text" required 
                                                                                autocomplete="off"
                                                                                onkeyup="this.value=this.value.replace(/[^0-9.]/g, '')" />
                                                                        </div>
                                                                        <div class="zip-content">
                                                                            <label>Zip / Postal Code</label>
                                                                            <input type="text" autocomplete="off"
                                                                                 />
                                                                        </div>
                                                                        <div class="clr"></div>
                                                                    </div>
                                                                    <button type="submit">Continue To Checkout</button>
                                                                </div>
                                                            </div>
    
                                                            <div class="clr"></div>
                                                        </div>
                                                        <div class="clr"></div>
                                                    </form>
                                                </div>
                                            </section>
                                        </basis>
                                        <basis core="group" name="Rayancard" if="[##cms.form.bank_id##] = 73">
                                            <basis core="inlinesource" name="db">
                                                <member name="acceptcode" format="json"
                                                postsql="select value from [db.acceptcode] where field = 'acceptcode'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="password" format="json"
                                                    postsql="select value from [db.password] where field = 'password'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="callback" format="json"
                                                    postsql="select value from [db.callback] where field = 'callback'">
                                                    {"root":[##db.webservice_detail.result##]} </member>
                                                <member name="bankid" format="json" postsql="select value from [db.bankid] where field = 'bankid'">
                                                      {"root":[##db.webservice_detail.result##]} </member>
                                            </basis>
                                            <basis core="group" name="bankgroup">
                                                <basis core="external.ws.ws" service="rayanCardPayment" name="rayancard" source="cmsDbService" procedurename="sbserviceprocedure1" preview="true">
                                                    <member name="m1" method="token" sort="random">
                                                       <params>
                                                          <param name="acceptcode" value="[##db.acceptcode.Value##]"/>
                                                          <param name="password" value="[##db.password.Value##]"/>
                                                          <param name="orderid" value="[##db.paymentid.Column1##]"/>
                                                          <param name="redirect_url" value="[##site.address.domain##]/Client_CallBack_en.bc"/>
                                                          <param name="amount" value="[##db.firstpay.Value##]"/>
                                                       </params>
                                                    </member>
                                                 </basis>
                                                <basis core="group" name="delay4">
                                                    <input type="hidden" value='[##rayancard.m1.result##]' id="json" />
                                                    <input type="hidden" value="" id="action" />
                                                    <div class="sectionInfo"></div>
                                                    <script type="text/javascript">
                                                        var str = document.getElementById("json").value;
                                                        str = str.replace(/"/g, ' ');
                                                        if (str == 'Time Out') {
                                                            document.getElementById("action").value = 0;
                                                        } else {
                                                            document.getElementById("action").value = 1;
                                                        }
                                                        var obj = new Object([##rayancard.m1.result##]);
                                                        var obj_1 = obj["rayancard_m1"]["url"]
    
                                                        $.ajax({
                                                            url: "/Client_Get_Token_en.bc",
                                                            type: "post",
                                                            data: {
                                                                payment_url: obj_1,
                                                                token: $("#json").val(),
                                                                action: $("#action").val(),
                                                                bank_id: 73
                                                            },
                                                            success: function (result) {
                                                                $(".sectionInfo").empty().html(result)
                                                            }
                                                        });
                                                    </script>
                                                </basis>
                                            </basis>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 35">
                                        <basis core="inlinesource" name="db">
                                            <member name="merchantID" format="json"
                                                postsql="select value from [db.merchantID] where field = 'merchantid'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="external.ws.ws" service="zarrinPal" name="zarrinPal"
                                            source="cmsDbService" procedurename="sbserviceprocedure1" preview="true">
                                            <member name="m1" method="PaymentRequest" sort="random" preview="true">
                                                <params>
                                                    <param name="MerchantID" value="[##db.merchantID.value##]" />
                                                    <param name="Amount" value="[##db.firstpay.Value##]" />
                                                    <param name="Description" value="get token for payment" />
                                                    <param name="Email" value="" />
                                                    <param name="Mobile" value="" />
                                                    <param name="CallbackURL"
                                                        value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                </params>
                                            </member>
                                        </basis>
                                        <basis core="group" name="InnerDelay">
                                            <input type="hidden" value='[##zarrinPal.m1.result##]' id="json" />
                                            <input type="hidden" value="" id="action" />
                                            <div class="sectionInfo"></div>
                                            <script type="text/javascript">
                                                var str = document.getElementById("json").value;
                                                var split_str = str.split('/')
                                                str = str.replace(/'"/g, ' ');
                                                if (str == 'Time Out') {
                                                    document.getElementById("action").value = 0;
                                                } else {
                                                    document.getElementById("action").value = 1;
                                                }
                                                $.ajax({
                                                    url: "/Client_Get_Token_en.bc",
                                                    type: "post",
                                                    data: {
                                                        token: $("#json").val(),
                                                        action: $("#action").val(),
                                                        bank_id: 35,
                                                        Authority: split_str[5].replace(/[^\x00-\x7F]/g,
                                                            ""),
                                                        paymentid: "[##db.paymentid.Column1##]",
                                                        bankid: "[##db.bankid.Value##]",
                                                        supplier: "[##cms.form.supplier##]",
                                                        totalfinal: "[##db.firstpay.Value##]",
                                                        paytype: "[##cms.form.paytype##]",
                                                        agencyid: "[##cms.form.agencyid|(0)##]",
                                                        factorid: "[##db.Factorid.Value|(0)##]",
                                                        factortype: 2
                                                    },
                                                    success: function (result) {
                                                        $(".sectionInfo").empty().html(result)
                                                    }
                                                });
                                            </script>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 51">
                                        <basis core="inlinesource" name="db">
                                            <member name="token" format="json"
                                                postsql="select value from [db.token] where field = 'token'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="external.ws.ws" service="kipaaPayment" name="kipaa"
                                            source="cmsDbService" procedurename="sbserviceprocedure1" preview="true">
                                            <member name="m1" method="request_payment_token" sort="random"
                                                preview="true">
                                                <params>
                                                    <param name="amount" value="[##db.firstpay.Value##]" />
                                                    <param name="callback"
                                                        value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                    <param name="token" value="[##db.token.Value##]" />
                                                </params>
                                            </member>
                                        </basis>
                                        <basis core="group" name="InnerDelay">
                                            <div class="sectionInfo"></div>
                                            <input type="hidden" value="" id="action" />
                                            <script type="text/javascript">
                                                var obj = new Object([##kipaa.m1.result##])
                                                var obj_1 = obj["kipaa_m1"]["answer"]
                                                var obj_2 = JSON.parse(obj_1)
                                                if (obj_2["Status"] == '200') {
                                                    document.getElementById("action").value = 1;
                                                } else {
                                                    document.getElementById("action").value = 0;
                                                }
                                                $.ajax({
                                                    url: "/Client_Get_Token_en.bc",
                                                    type: "post",
                                                    data: {
                                                        token: obj_2["Content"]["payment_token"],
                                                        payment_url: "https://" + obj_2["Content"][
                                                            "payment_url"
                                                        ],
                                                        action: $("#action").val(),
                                                        bank_id: 51,
                                                        paymentid: "[##db.paymentid.Column1##]",
                                                        bankid: "[##db.bankid.Value##]",
                                                        supplier: "[##cms.form.supplier##]",
                                                        totalfinal: "[##db.firstpay.Value##]",
                                                        paytype: "[##cms.form.paytype##]",
                                                        agencyid: "[##cms.form.agencyid|(0)##]",
                                                        factorid: "[##db.Factorid.Value|(0)##]",
                                                        factortype: 2
                                                    },
                                                    success: function (result) {
                                                        $(".sectionInfo").empty().html(result)
                                                    }
                                                });
                                            </script>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 55">
                                        <basis core="inlinesource" name="db">
                                            <member name="token" format="json"
                                                postsql="select value from [db.token] where field = 'token'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="external.ws.ws" service="aghayePardakht" name="aghayePardakht"
                                            source="cmsDbService" procedurename="sbserviceprocedure1">
                                            <member name="m1" method="createToken" sort="random" preview="true">
                                                <params>
                                                    <param name="pin" value="[##db.token.Value##]" />
                                                    <param name="amount" value="[##db.firstpay.Value##]" />
                                                    <param name="callback"
                                                        value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                    <param name="invoice_id" value="[##db.Factorid.Value|(0)##]" />
                                                </params>
                                            </member>
                                        </basis>

                                        <basis core="group" name="InnerDelay">
                                            <div class="sectionInfo"></div>
                                            <input type="hidden" value="1" id="action" />
                                            <script type="text/javascript">
                                                var obj = new Object([##aghayePardakht.m1.result##])
                                                var obj_1 = obj["aghayePardakht_m1"]["url"]
                                                var split_obj_1 = obj_1.split('/')
                                                $.ajax({
                                                    url: "/Client_Get_Token_en.bc",
                                                    type: "post",
                                                    data: {
                                                        token: split_obj_1[4],
                                                        payment_url: obj_1,
                                                        action: $("#action").val(),
                                                        bank_id: 55,
                                                        paymentid: "[##db.paymentid.Column1##]",
                                                        bankid: "[##db.bankid.Value##]",
                                                        supplier: "[##cms.form.supplier##]",
                                                        totalfinal: "[##db.firstpay.Value##]",
                                                        paytype: "[##cms.form.paytype##]",
                                                        agencyid: "[##cms.form.agencyid|(0)##]",
                                                        factorid: "[##db.Factorid.Value|(0)##]",
                                                        factortype: 2
                                                    },
                                                    success: function (result) {
                                                        $(".sectionInfo").empty().html(result)
                                                    }
                                                });
                                            </script>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 57">
                                        <basis core="inlinesource" name="db">
                                            <member name="username" format="json"
                                                postsql="select value from [db.username] where field = 'username'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="password" format="json"
                                                postsql="select value from [db.password] where field = 'password'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="serviceId" format="json"
                                                postsql="select value from [db.serviceId] where field = 'serviceId'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json"
                                                postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="external.ws.ws" service="ayandeh" name="ayandeh"
                                            source="cmsDbService" procedurename="sbserviceprocedure1">
                                            <member name="m1" method="createToken" sort="random" preview="true">
                                                <params>
                                                    <param name="username" value="[##db.username.value##]" />
                                                    <param name="password" value="[##db.password.value##]" />
                                                    <param name="callBackUrl"
                                                        value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                    <param name="serviceId" value="[##db.serviceId.value##]" />
                                                    <param name="amount" value="[##db.firstpay.Value##]" />
                                                    <param name="mobile" value="" />
                                                </params>
                                            </member>
                                        </basis>
                                        <basis core="group" name="InnerDelay">
                                            <input type="hidden" value='[##ayandeh.m1.result##]' id="json" />
                                            <input type="hidden" value="1" id="action" />
                                            <div class="sectionInfo"></div>
                                            <script type="text/javascript">
                                                $.ajax({
                                                    url: "/Client_Get_Token_en.bc",
                                                    type: "post",
                                                    data: {
                                                        token: $("#json").val(),
                                                        action: $("#action").val(),
                                                        bank_id: 57,
                                                        paymentid: "[##db.paymentid.Column1##]",
                                                        bankid: "[##db.bankid.Value##]",
                                                        supplier: "[##cms.form.supplier##]",
                                                        totalfinal: "[##db.firstpay.Value##]",
                                                        paytype: "[##cms.form.paytype##]",
                                                        agencyid: "[##cms.form.agencyid|(0)##]",
                                                        factorid: "[##db.Factorid.Value|(0)##]",
                                                        factortype: 2
                                                    },
                                                    success: function (result) {
                                                        $(".sectionInfo").empty().html(result)
                                                    }
                                                });
                                            </script>
                                        </basis>
                                    </basis>
                                    <basis core="group" name="Delay_save_inputs" if="[##cms.form.bank_id##] = 66">
                                        <basis core="inlinesource" name="db">
                                            <member name="usr" format="json" postsql="select value from [db.usr] where field = 'usr'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="pwd" format="json" postsql="select value from [db.pwd] where field = 'pwd'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="merchantConfigurationId" format="json"
                                                postsql="select value from [db.merchantConfigurationId] where field = 'merchantConfigurationId'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                            <member name="callback" format="json" postsql="select value from [db.callback] where field = 'callback'">
                                                {"root":[##db.webservice_detail.result##]} </member>
                                        </basis>
                                        <basis core="external.ws.ws" service="shahrBank" name="shahr" source="cmsDbService"
                                            procedurename="sbserviceprocedure1">
                                            <member name="m1" method="token" sort="random" preview="true">
                                                <params>
                                                    <param name="usr" value="[##db.usr.value##]" />
                                                    <param name="pwd" value="[##db.pwd.value##]" />
                                                    <param name="merchantConfigurationId" value="[##db.merchantConfigurationId.value##]" />
                                                    <param name="localInvoiceId" value="[##db.Factorid.Value|(0)##]" />
                                                    <param name="amount" value="[##db.firstpay.Value##]" />
                                                    <param name="callbackurl" value="[##site.address.domain##]/Client_CallBack_en.bc" />
                                                </params>
                                            </member>
                                        </basis>
                                        <basis core="group" name="InnerDelay">
                                            <input type="hidden" value="1" id="action" />
                                            <div class="sectionInfo"></div>
                                            <script type="text/javascript">
                                                var obj = new Object([##shahr.m1.result##]);
                                                var obj_1 = obj["shahr_m1"]["url"]
                                                var obj_2 = obj["shahr_m1"]["token"]
                                                $.ajax({
                                                    url: "/Client_Get_Token_en.bc",
                                                    type: "post",
                                                    data: {
                                                        token: obj_2,
                                                        payment_url: obj_1,
                                                        action: $("#action").val(),
                                                        bank_id: 66,
                                                        paymentid: "[##db.paymentid.Column1##]",
                                                        bankid: "[##db.bankid.Value##]",
                                                        supplier: "[##cms.form.supplier##]",
                                                        totalfinal: "[##db.firstpay.Value##]",
                                                        paytype: "[##cms.form.paytype##]",
                                                        agencyid: "[##cms.form.agencyid|(0)##]",
                                                        factorid: "[##db.Factorid.Value|(0)##]",
                                                        factortype: 2
                                                    },
                                                    success: function (result) {
                                                        $(".sectionInfo").empty().html(result)
                                                    }
                                                });
                                            </script>
                                        </basis>
                                    </basis>
                                </basis>



                            </basis>
                        </basis>
                    </basis>
                    <basis core="group" name="DelayFactorpreformE" if="'[##db.TypeFactorpreform.Value##]'='1'">
                        <input type="hidden" value="[##db.CodeFactorpreform.Value##]" class="CodeFactorpreform" />
                        <basis core="group" name="DelayFactorpreformECode" if="'[##db.CodeFactorpreform.Value##]'='1'">
                            <form method="post" action="/ServiceView_EN.bc" class="FormRedirect">
                                <input type="hidden" value='[##cms.form.idnows##]' name="idnows" />
                                <input type="hidden" value='[##cms.form.idws##]' name="idws" />
                                <input type="hidden" value='[##cms.form.childcount##]' name="childcount" />
                                <input type="hidden" value='[##cms.form.infantcount##]' name="infants" />
                                <input type="hidden" value='[##cms.form.adultcount##]' name="adultcount" />
                                <input type="hidden" value='[##cms.form.supplier##]' name="supplier" />
                                <input type="hidden" value='[##cms.form.share##]' name="share" />
                                <input type="hidden" value='[##cms.form.idvalue##]' name="idvalue" />
                                <input type="hidden" value='[##cms.form.provider##]' name="provider" />
                                <input type="hidden" value='[##cms.form.mainprovider##]' name="mainprovider" />
                                <input type="hidden" value='[##cms.form.classname##]' name="classname" />
                                <input type="hidden" name="edit" value="0" />
                                <input type="hidden" value="[##cms.form.FlightClass##]" name="FlightClass" />
                                <input type="hidden" value="[##cms.form.from##]" name="from" />
                                <input type="hidden" value="[##cms.form.to##]" name="to" />
                                <input type="hidden" value="[##cms.form.adult##]" name="adult" />
                                <input type="hidden" value="[##cms.form.child##]" name="child" />
                                <input type="hidden" value="[##cms.form.select-age##]" name="select-age" />
                                <input type="hidden" value="[##cms.form.userid##]" name="userid" />
                                <input type="hidden" value="[##cms.form.fdate##]" name="fdate" />
                                <input type="hidden" value="[##cms.form.tdate##]" name="tdate" />
                                </form>
                                <script type="text/javascript">
                                    $.confirm({
                                       title: 'Warning',
                                        content: '[##db.DescriptionFactorpreform.Value##]',
                                        confirmButton: 'Move to previous page',
                                        cancelButton: 'Move to Home',
                                        animation: 'top',
                                        closeAnimation: 'scale',
                                        onOpen: function () {},
                                        confirm: function () {
                                            $(".FormRedirect").submit()
                                        },
                                        cancel: function () {
                                             window.location = '/EN'
                                        }
                                    })
                                </script>
                        </basis>
                        <basis core="group" name="DelayFactorpreformECode"
                            if="'[##db.CodeFactorpreform.Value##]'<>'1' and '[##db.CodeFactorpreform.Value##]'<>'0'">
                            <script type="text/javascript">
                                $.confirm({
                                   title: 'Warning',
                                   content: '[##db.DescriptionFactorpreform.Value##]. (Contact agency support)',
                                    confirmButton: '',
                                    cancelButton: 'Move to Home',
                                    animation: 'top',
                                    closeAnimation: 'scale',
                                    onOpen: function () {},
                                    cancel: function () {
                                         window.location = '/EN'
                                    }
                                })
                            </script>
                        </basis>
                    </basis>
                    <basis core="group" name="DelayFactorpreformE" if="'[##db.TypeFactorpreform.Value##]'='2'">
                        <input type="hidden" value="[##db.CodeFactorpreform.Value##]" class="CodeFactorpreform" />
                        <form method="post" class="FactorForm" action="/Client_Final_Alert_en.bc">
                            <input type="hidden" value="[##cms.form.accounttype##]" name="accounttype" />
                            <input type="hidden" value="[##cms.form.bank_id##]" name="bank_id" />
                            <input type="hidden" value="[##db.Factorid.Value##]" name="factorid" />
                            <input type="hidden" value="[##db.total.Value##]" name="total">
                                <input type="hidden" value="[##db.firstpay.Value##]" name="firstpay">
                                    <input type="hidden" value="[##cms.form.paytype##]" name="paytype" />
                                    <input type="hidden" value="[##cms.form.userid##]" name="userid" />
                                    <input type="hidden" value="[##cms.form.agencyid|(0)##]" name="agencyid" />
                                    <input type="hidden" value="[##cms.form.supplier##]" name="supplier" />
                                    <input type="hidden" value="[##cms.form.moneytype##]" name="moneytype" />
                                    <input type="hidden" value="[##cms.form._root.account.fullname.firstname##]"
                                        name="firstname" />
                                    <input type="hidden" value="[##cms.form._root.account.fullname.lastname##]"
                                        name="lastname" />
                                    <input type="hidden" value="[##cms.form._root.account.email##]" name="email" />
                                    <input type="hidden" value="[##cms.form._root.account.gender##]" name="gender" />
                                    <input type="hidden" value="[##cms.form._root.account.tel##]" name="tel" />
                                    <input type="hidden" value="[##cms.form._root.account.mobile##]" name="mobile" />
                                    <input type="hidden" value="[##cms.form._root.account.address##]" name="address" />
                                    <input type="hidden" value="[##cms.form._root.account.birthdate##]"
                                        name="birthdate" />
                                    <input type="hidden" value="[##cms.form._root.account.codepost##]"
                                        name="codepost" />
                                    <input type="hidden" value="[##cms.form._root.account.fax##]" name="fax" />
                                    <input type="hidden" value="2" name="factortype" />
                                    </form>
                                    <script type="text/javascript">
                                        $.confirm({
                                           title: 'Warning',
                                           content: '<p class="DescriptionFactorpreform">[##db.DescriptionFactorpreform.Value##]<p> Do you want to continue the booking process with the amount of<span class="NewpriceFactorpreform"> [##db.NewpriceFactorpreform.Value##]</span> [##cms.form.moneytype##] ?',
                                            confirmButton: 'Yes',
                                            cancelButton: 'No',
                                            animation: 'top',
                                            closeAnimation: 'scale',
                                            onOpen: function () {},
                                            confirm: function () {
                                                $(".FactorForm").submit()
                                            },
                                            cancel: function () {
                                                 window.location = '/EN'
                                            }
                                        })
                                        $(".NewpriceFactorpreform").text(function (index, value) {
                                            return value
                                                .replace(/\D/g, "")
                                                .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                        });
                                    </script>
                    </basis>
                    <basis core="group" name="DelayFactorpreformE" if="'[##db.TypeFactorpreform.Value##]'='3'">
                        <input type="hidden" value="[##db.CodeFactorpreform.Value##]" class="CodeFactorpreform" />
                        <form method="post" class="FactorForm" action="/Client_Final_Alert_en.bc">
                            <input type="hidden" value="[##cms.form.accounttype##]" name="accounttype" />
                            <input type="hidden" value="[##cms.form.bank_id##]" name="bank_id" />
                            <input type="hidden" value="[##db.Factorid.Value##]" name="factorid" />
                            <input type="hidden" value="[##db.total.Value##]" name="total">
                                <input type="hidden" value="[##db.firstpay.Value##]" name="firstpay">
                                    <input type="hidden" value="[##cms.form.paytype##]" name="paytype" />
                                    <input type="hidden" value="[##cms.form.userid##]" name="userid" />
                                    <input type="hidden" value="[##cms.form.agencyid|(0)##]" name="agencyid" />
                                    <input type="hidden" value="[##cms.form.supplier##]" name="supplier" />
                                    <input type="hidden" value="[##cms.form.moneytype##]" name="moneytype" />
                                    <input type="hidden" value="[##cms.form._root.account.fullname.firstname##]"
                                        name="firstname" />
                                    <input type="hidden" value="[##cms.form._root.account.fullname.lastname##]"
                                        name="lastname" />
                                    <input type="hidden" value="[##cms.form._root.account.email##]" name="email" />
                                    <input type="hidden" value="[##cms.form._root.account.gender##]" name="gender" />
                                    <input type="hidden" value="[##cms.form._root.account.tel##]" name="tel" />
                                    <input type="hidden" value="[##cms.form._root.account.mobile##]" name="mobile" />
                                    <input type="hidden" value="[##cms.form._root.account.address##]" name="address" />
                                    <input type="hidden" value="[##cms.form._root.account.birthdate##]"
                                        name="birthdate" />
                                    <input type="hidden" value="[##cms.form._root.account.codepost##]"
                                        name="codepost" />
                                    <input type="hidden" value="[##cms.form._root.account.fax##]" name="fax" />
                                    <input type="hidden" value="2" name="factortype" />
                                    </form>
                                    <script type="text/javascript">
                                        $.confirm({
                                           title: 'Warning',
                                           content: '<p class="DescriptionFactorpreform">[##db.DescriptionFactorpreform.Value##]</p> Do you want to continue the booking process on the<span class="NewtimeFactorpreform"> [##db.NewtimeFactorpreform.Value##]</span>  ?',
                                            confirmButton: 'Yes',
                                            cancelButton: 'No',
                                            animation: 'top',
                                            closeAnimation: 'scale',
                                            onOpen: function () {},
                                            confirm: function () {
                                                $(".FactorForm").submit()
                                            },
                                            cancel: function () {
                                                 window.location = '/EN'
                                            }
                                        })
                                    </script>
                    </basis>

                </basis>
            </basis>
        </basis>
    </basis>
</basis>